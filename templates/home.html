{% extends 'base.html' %} {% block title %}Summary Dashboard{% endblock %} {%
block content %}
<!-- Forecast / Current Conditions -->
<section class="py-40">
	<div class="row row-gap-4">
		<!-- LEFT: Current & Highlights -->
		<div class="col-xxl-8">
			<!-- Current Weather Card -->
			<div class="weekly-forecast mb-32">
				<div class="row row-gap-sm-5 row-gap-4">
					<div class="col-lg-4">
						<div class="selected-location">
							<div class="img-block">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-1.png') }}"
									alt=""
								/>
							</div>
							<div class="d-flex justify-content-between align-items-center">
								<div>
									<h4 class="color-white mb-4p">
										{{ latest.StationID if latest else '—' }}
									</h4>
									<h6 class="lightest-gray">
										{{ latest.WindDirection }} • {{ latest.WindSpeed }} m/s • {{
										latest.Humidity }}%
									</h6>
								</div>
								<h1 class="color-white">{{ latest.Temperature }}°</h1>
							</div>
							<p class="lightest-gray mt-8">
								<small>{{ latest.DateTime }}</small>
							</p>
						</div>
					</div>

					<!-- Mini "next hours" cards -->
					<div class="col-lg-8">
						<div class="row weekly-forecast-carousel">
							{% for row in weather[:6] %}
							<div class="col-12">
								<div class="week-day-card">
									<div
										class="d-flex justify-content-between align-items-center"
									>
										<img
											src="{{ url_for('static', filename='media/forecast-icons/i-' ~ (loop.index % 4 + 1) ~ '.png') }}"
											alt=""
										/>
										<h3 class="bold-text color-black">
											{{ row.Temperature }}°
										</h3>
									</div>
									<div>
										<p class="color-black fw-600">{{ row.SensorTime }}</p>
										<p class="light-gray fw-500">
											{{ row.WindDirection }} • {{ row.WindSpeed }} m/s
										</p>
									</div>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>

			<!-- Today's Highlights -->
			<div class="today-highlights">
				<h4 class="mb-24">Today's Highlights</h4>
				<div class="row row-gap-sm-4 row-gap-3">
					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-5.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Feels Like</h5>
									<p class="fw-500">Approx</p>
								</div>
							</div>
							<h4 class="color-black bold-text">{{ latest.Temperature }}°</h4>
						</div>
					</div>

					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-7.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Humidity</h5>
									<p class="fw-500">Current</p>
								</div>
							</div>
							<h4 class="color-black bold-text">{{ latest.Humidity }}%</h4>
						</div>
					</div>

					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-2.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Rain (hr/day)</h5>
									<p class="fw-500">Now</p>
								</div>
							</div>
							<h4 class="color-black bold-text">
								{{ latest.HourlyRain }} / {{ latest.DailyRain }} mm
							</h4>
						</div>
					</div>

					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-4.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Wind</h5>
									<p class="fw-500">{{ latest.WindDirection }}</p>
								</div>
							</div>
							<h4 class="color-black bold-text d-flex align-items-center gap-1">
								{{ latest.WindSpeed }} <span class="n-text">m/s</span> &nbsp;
								({{ latest.WindDegree }}°)
							</h4>
						</div>
					</div>

					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-8.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Water Level</h5>
									<p class="fw-500">Distance</p>
								</div>
							</div>
							<h4 class="color-black bold-text">{{ latest.WaterLevel }} m</h4>
						</div>
					</div>

					<div class="col-lg-4 col-sm-6">
						<div class="today-highlight-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-6.png') }}"
									alt=""
								/>
								<div>
									<h5 class="light-black">Updated</h5>
									<p class="fw-500">Sensor Time</p>
								</div>
							</div>
							<h4 class="color-black bold-text">{{ latest.SensorTime }}</h4>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- RIGHT: Other Stations -->
		<div class="col-xxl-4">
			<div class="cities-forecast">
				<h5 class="mb-24">Other Stations</h5>
				<div class="row row-gap-3">
					{% for item in weather[:6] %}
					<div class="col-xxl-12 col-sm-6">
						<div class="cities-forecast-card">
							<div class="d-flex align-items-center column-gap-2">
								<img
									src="{{ url_for('static', filename='media/forecast-icons/i-' ~ (loop.index % 3 + 2) ~ '.png') }}"
									alt=""
								/>
								<div>
									<h6 class="light-black">{{ item.StationID }}</h6>
									<p class="fw-500 light-gray d-flex align-items-center gap-1">
										<span
											>Wind: {{ item.WindDirection }} {{ item.WindSpeed }}
											m/s</span
										>
										<span>Hum: {{ item.Humidity }}%</span>
									</p>
								</div>
							</div>
							<h4 class="color-black bold-text">{{ item.Temperature }}°</h4>
						</div>
					</div>
					{% endfor %}
					<div class="col-12">
						<a href="#" class="cus-btn w-100">See More <span></span></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- Temperature Trend Chart -->
<section class="py-40">
	<h4 class="mb-24">Temperature Trend (Latest 24 Hours)</h4>
	<div class="chart-box">
		<div id="chartContainer"></div>
	</div>
</section>
{% endblock %} {% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
	// Pass Python data to JavaScript
	const weatherData = {{ weather|tojson }};
	const labels = weatherData.slice(0, 24).map(r => r.SensorTime || r.DateTime);
	const temps = weatherData.slice(0, 24).map(r => Number(r.Temperature));

	const chart = new ApexCharts(document.querySelector("#chartContainer"), {
	    chart: {
	        type: 'line',
	        height: 280,
	        toolbar: { show: false },
	        animations: {
	            enabled: true,
	            easing: 'easeinout',
	            speed: 800
	        }
	    },
	    series: [{ name: 'Temperature °C', data: temps }],
	    xaxis: {
	        categories: labels,
	        tickAmount: 6,
	        labels: {
	            rotate: -45,
	            rotateAlways: true
	        }
	    },
	    stroke: { width: 3, curve: 'smooth' },
	    markers: { size: 3 },
	    grid: { strokeDashArray: 4 },
	    tooltip: {
	        x: { show: true },
	        y: {
	            formatter: function(val) {
	                return val + "°C";
	            }
	        }
	    },
	    colors: ['#3B82F6']
	});
	chart.render();
</script>
{% endblock %}
